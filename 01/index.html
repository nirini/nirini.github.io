<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image Resizer & Converter</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f9; color: #333; }
    h1 { text-align: center; }
    .container { max-width: 600px; margin: auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    input, select, button { margin: 10px 0; padding: 8px; max-width: 100%; }
    canvas { max-width: 100%; margin-top: 20px; }
    .warning { color: red; font-weight: bold; }
    .info { margin-top: 10px; font-size: 14px; color: #555; }
  </style>
</head>
<body>
<a href="https://nirini.github.io/">NiRiNi</a>
  <div class="container">
    <h1>Image Resizer & Converter</h1>
    <input type="file" id="upload" accept="image/*"><label>Resize Mode:</label>
<select id="resizeMode">
  <option value="scale">Scale (%)</option>
  <option value="pixels">Dimensions (px)</option>
  <option value="dpi">Physical Size + DPI</option>
</select>

<div id="scaleBox">
  <label>Scale (%):</label>
  <input type="number" id="scale" value="100">
</div>

<div id="pixelBox" style="display:none;">
  <label>Width (px):</label>
  <input type="number" id="width">
  <label>Height (px):</label>
  <input type="number" id="height">
</div>

<div id="dpiBox" style="display:none;">
  <label>Width (cm):</label>
  <input type="number" id="cmWidth">
  <label>Height (cm):</label>
  <input type="number" id="cmHeight">
  <label>DPI:</label>
  <input type="number" id="dpi" value="300">
</div>

<label>Output Format:</label>
<select id="format">
  <option value="image/jpeg">JPEG</option>
  <option value="image/png">PNG</option>
  <option value="image/webp">WEBP</option>
</select>

<label>Max File Size (KB):</label>
<input type="number" id="maxSize" value="300">

<button onclick="processImage()">Apply & Preview</button>
<a id="download" style="display:none;"><button>Download</button></a>

<div class="info" id="resultInfo"></div>
<canvas id="canvas"></canvas>

  </div>  <script>
    const upload = document.getElementById('upload');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const resizeMode = document.getElementById('resizeMode');

    resizeMode.addEventListener('change', () => {
      document.getElementById('scaleBox').style.display = resizeMode.value === 'scale' ? 'block' : 'none';
      document.getElementById('pixelBox').style.display = resizeMode.value === 'pixels' ? 'block' : 'none';
      document.getElementById('dpiBox').style.display = resizeMode.value === 'dpi' ? 'block' : 'none';
    });

    let img = new Image();
    upload.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => { img.src = evt.target.result; };
      reader.readAsDataURL(file);
    });

    async function compressToMaxSize(canvas, format, maxKB) {
      let quality = 0.92;
      let step = 0.05;
      let blob = await new Promise(r => canvas.toBlob(r, format, quality));

      while (blob.size / 1024 > maxKB && quality > 0.2) {
        quality -= step;
        blob = await new Promise(r => canvas.toBlob(r, format, quality));
      }
      return blob;
    }

    async function processImage() {
      if (!img.src) return;

      let newWidth, newHeight;
      if (resizeMode.value === 'scale') {
        const scale = document.getElementById('scale').value / 100;
        newWidth = img.width * scale;
        newHeight = img.height * scale;
      } else if (resizeMode.value === 'pixels') {
        newWidth = document.getElementById('width').value || img.width;
        newHeight = document.getElementById('height').value || img.height;
      } else if (resizeMode.value === 'dpi') {
        const cmWidth = document.getElementById('cmWidth').value;
        const cmHeight = document.getElementById('cmHeight').value;
        const dpi = document.getElementById('dpi').value;
        newWidth = cmWidth * dpi / 2.54;
        newHeight = cmHeight * dpi / 2.54;
      }

      canvas.width = newWidth;
      canvas.height = newHeight;
      ctx.drawImage(img, 0, 0, newWidth, newHeight);

      const format = document.getElementById('format').value;
      const maxKB = parseInt(document.getElementById('maxSize').value);

      const blob = await compressToMaxSize(canvas, format, maxKB);

      const url = URL.createObjectURL(blob);
      const download = document.getElementById('download');
      download.href = url;
      download.download = `resized.${format.split('/')[1]}`;
      download.style.display = 'block';

      const resultInfo = document.getElementById('resultInfo');
      const sizeKB = (blob.size / 1024).toFixed(2);
      if (sizeKB > maxKB) {
        resultInfo.innerHTML = `<span class='warning'>⚠ Final size: ${sizeKB} KB (exceeds max ${maxKB} KB)</span>`;
      } else {
        resultInfo.innerHTML = `✅ Final size: ${sizeKB} KB (within limit)`;
      }
    }
  </script></body>
</html>