<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Size Resizer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-lg">
    <h1 class="text-2xl font-bold text-center mb-4">ðŸ“„ PDF Size Resizer</h1>

    <input type="file" id="pdfFile" accept="application/pdf"
           class="block w-full mb-4 border rounded-lg p-2">

    <label class="block mb-2 font-semibold">Desired Size (KB):</label>
    <input type="number" id="desiredSize" placeholder="e.g. 500 (KB)"
           class="w-full border p-2 rounded-lg mb-4">

    <button onclick="resizePDF()" 
            class="bg-blue-600 text-white w-full p-3 rounded-xl font-semibold hover:bg-blue-700">
      Resize & Download
    </button>

    <p id="status" class="mt-4 text-center text-gray-600"></p>
  </div>

  <script>
    async function resizePDF() {
      const fileInput = document.getElementById("pdfFile");
      const desiredSizeKB = parseInt(document.getElementById("desiredSize").value);
      const status = document.getElementById("status");

      if (!fileInput.files.length || !desiredSizeKB) {
        status.textContent = "âš ï¸ Please upload a PDF and enter desired size!";
        return;
      }

      const file = fileInput.files[0];
      let arrayBuffer = await file.arrayBuffer();
      let fileSizeKB = Math.round(arrayBuffer.byteLength / 1024);

      status.textContent = `Original Size: ${fileSizeKB} KB â³ Processing...`;

      let outputBytes = arrayBuffer;
      let newSizeKB = fileSizeKB;

      // CASE 1: Compress if too big
      if (fileSizeKB > desiredSizeKB) {
        let scale = 1.0;
        while (newSizeKB > desiredSizeKB) {
          scale *= 0.9; // shrink by 10%

          const pdfDoc = await PDFLib.PDFDocument.load(outputBytes);
          const pages = pdfDoc.getPages();
          pages.forEach(page => {
            const { width, height } = page.getSize();
            page.setSize(width * 0.9, height * 0.9);
          });

          outputBytes = await pdfDoc.save();
          newSizeKB = Math.round(outputBytes.byteLength / 1024);

          if (newSizeKB < 20) break; // safety
        }
      }

      // CASE 2: Expand if too small
      else if (fileSizeKB < desiredSizeKB - 20) {
        let scale = 1.0;
        while (newSizeKB < desiredSizeKB - 20) {
          scale *= 1.1; // enlarge by 10%

          const pdfDoc = await PDFLib.PDFDocument.load(outputBytes);
          const pages = pdfDoc.getPages();
          pages.forEach(page => {
            const { width, height } = page.getSize();
            page.setSize(width * 1.1, height * 1.1);
          });

          outputBytes = await pdfDoc.save();
          newSizeKB = Math.round(outputBytes.byteLength / 1024);

          if (newSizeKB > desiredSizeKB) {
            // If overshoot, revert last change
            newSizeKB = Math.round(outputBytes.byteLength / 1024);
            break;
          }
        }
      }

      // Download final PDF
      if (newSizeKB <= desiredSizeKB) {
        const blob = new Blob([outputBytes], { type: "application/pdf" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "resized.pdf";
        a.click();

        status.textContent = `âœ… Success! Output size: ${newSizeKB} KB (<= ${desiredSizeKB} KB)`;
      } else {
        status.textContent = `âš ï¸ Could not resize correctly. Final size: ${newSizeKB} KB`;
      }
    }
  </script>
</body>
</html>